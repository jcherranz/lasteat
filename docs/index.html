<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macarfi Madrid — Restaurantes</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=DM+Sans:opsz,wght@9..40,300..500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #F7F5F0;
    --surface: #FFFFFF;
    --text: #1C1917;
    --secondary: #57534E;
    --muted: #A8A29E;
    --accent: #B45A3C;
    --accent-soft: rgba(180, 90, 60, 0.06);
    --border: #E7E5E1;
    --radius: 5px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ── Masthead ── */
  header {
    padding: 3.5rem 2rem 0;
    text-align: center;
  }
  .logo {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: 2.8rem;
    font-weight: 300;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    line-height: 1.1;
    color: var(--text);
  }
  .stats {
    font-size: 0.78rem;
    color: var(--muted);
    margin-top: 0.75rem;
    letter-spacing: 0.06em;
    font-weight: 400;
  }
  .divider {
    width: 36px;
    height: 1px;
    background: var(--border);
    margin: 1.75rem auto 0;
  }

  /* ── Controls ── */
  .controls-wrap {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--bg);
  }
  .controls-wrap::after {
    content: '';
    position: absolute;
    bottom: -20px;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(var(--bg), transparent);
    pointer-events: none;
  }
  .controls {
    max-width: 1100px;
    margin: 0 auto;
    padding: 1.15rem 2rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  .search-box {
    flex: 1;
    min-width: 180px;
    padding: 0.55rem 0;
    border: none;
    border-bottom: 1px solid var(--border);
    font-size: 0.85rem;
    font-family: inherit;
    background: transparent;
    outline: none;
    transition: border-color 0.3s;
    color: var(--text);
  }
  .search-box::placeholder { color: var(--muted); }
  .search-box:focus { border-bottom-color: var(--accent); }

  select {
    padding: 0.5rem 1.8rem 0.5rem 0.65rem;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 0.8rem;
    font-family: inherit;
    background: var(--surface);
    color: var(--secondary);
    outline: none;
    cursor: pointer;
    max-width: 170px;
    transition: border-color 0.3s;
    -webkit-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23A8A29E'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.65rem center;
  }
  select:focus { border-color: var(--accent); }

  .sort-group {
    display: flex;
    align-items: center;
    gap: 0.1rem;
    margin-left: auto;
  }
  .sort-btn {
    padding: 0.4rem 0.6rem;
    border: none;
    border-radius: var(--radius);
    font-size: 0.78rem;
    font-family: inherit;
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    white-space: nowrap;
    transition: color 0.2s, background 0.2s;
  }
  .sort-btn:hover { color: var(--secondary); }
  .sort-btn.active {
    color: var(--text);
    background: var(--surface);
    font-weight: 500;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }

  /* ── Grid ── */
  .grid {
    max-width: 1100px;
    margin: 0.75rem auto 0;
    padding: 0 2rem 3rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 0.65rem;
  }

  /* ── Card ── */
  .card {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 1.2rem 1.4rem;
    display: flex;
    flex-direction: column;
    gap: 0.45rem;
    box-shadow: 0 0 0 1px rgba(0,0,0,0.03);
    transition: box-shadow 0.25s ease;
  }
  .card:hover {
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }

  .card-top {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 0.75rem;
  }
  .card-name {
    font-size: 0.9rem;
    font-weight: 500;
    line-height: 1.35;
  }
  .card-name a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s;
  }
  .card-name a:hover { color: var(--accent); }

  .card-rating {
    flex-shrink: 0;
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: 1.35rem;
    font-weight: 500;
    color: var(--text);
    line-height: 1;
  }
  .card-rating.no-rating {
    color: var(--muted);
    font-size: 1.1rem;
  }

  .card-meta {
    font-size: 0.78rem;
    color: var(--muted);
    display: flex;
    flex-wrap: wrap;
    gap: 0;
  }
  .card-meta span { white-space: nowrap; }
  .card-meta span + span::before {
    content: '\00b7';
    margin: 0 0.4rem;
    color: var(--border);
  }

  .card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
  }
  .tag {
    font-size: 0.67rem;
    padding: 0.15rem 0.45rem;
    background: var(--accent-soft);
    color: var(--accent);
    border-radius: 3px;
    white-space: nowrap;
    letter-spacing: 0.01em;
  }

  .card-ratings {
    display: flex;
    gap: 0.6rem;
    font-size: 0.72rem;
    color: var(--muted);
  }
  .card-ratings strong {
    color: var(--secondary);
    font-weight: 500;
  }

  .card-actions {
    display: flex;
    gap: 0.85rem;
    margin-top: auto;
    padding-top: 0.35rem;
  }
  .card-actions a {
    font-size: 0.72rem;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
    letter-spacing: 0.01em;
  }
  .card-actions a:hover { color: var(--accent); }

  .no-results {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 1.5rem;
    color: var(--muted);
    font-size: 0.88rem;
    background: var(--surface);
    border-radius: var(--radius);
  }

  /* ── Footer ── */
  footer {
    text-align: center;
    padding: 2.5rem 1.5rem;
    font-size: 0.72rem;
    color: var(--muted);
    letter-spacing: 0.04em;
  }
  footer a {
    color: var(--secondary);
    text-decoration: none;
    border-bottom: 1px solid var(--border);
    transition: border-color 0.2s, color 0.2s;
  }
  footer a:hover {
    border-bottom-color: var(--accent);
    color: var(--accent);
  }

  /* ── Responsive ── */
  @media (max-width: 640px) {
    header { padding: 2.5rem 1.25rem 0; }
    .logo { font-size: 2.1rem; }
    .controls { padding: 0.85rem 1.25rem; }
    .grid {
      grid-template-columns: 1fr;
      padding: 0 1.25rem 2rem;
    }
    .card { padding: 1rem 1.15rem; }
    .sort-group { margin-left: 0; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">Macarfi Madrid</div>
  <div class="stats" id="stats">Cargando...</div>
  <div class="divider"></div>
</header>

<div class="controls-wrap">
  <div class="controls">
    <input type="text" class="search-box" id="search" placeholder="Buscar restaurante, cocina, zona...">
    <select id="cuisine-filter"><option value="">Cocina</option></select>
    <select id="district-filter"><option value="">Zona</option></select>
    <select id="price-filter">
      <option value="">Precio</option>
      <option value="0-30">Hasta 30 &euro;</option>
      <option value="0-50">Hasta 50 &euro;</option>
      <option value="0-80">Hasta 80 &euro;</option>
      <option value="80-999">Desde 80 &euro;</option>
    </select>
    <div class="sort-group">
      <button class="sort-btn active" data-sort="rating">Ranking</button>
      <button class="sort-btn" data-sort="name">A-Z</button>
      <button class="sort-btn" data-sort="price">Precio</button>
    </div>
  </div>
</div>

<div class="grid" id="grid"></div>

<footer>
  Datos de <a href="https://macarfi.com/es/mad/restaurantes" target="_blank" rel="noopener">Macarfi</a>
  &middot; Actualizado feb 2026
</footer>

<script src="data.js"></script>
<script>
(function() {
  const grid = document.getElementById('grid');
  const searchInput = document.getElementById('search');
  const cuisineSelect = document.getElementById('cuisine-filter');
  const districtSelect = document.getElementById('district-filter');
  const priceSelect = document.getElementById('price-filter');
  const statsEl = document.getElementById('stats');

  // Populate filters
  const cuisines = [...new Set(RESTAURANTS.map(r => r.c).filter(Boolean))].sort();
  const districts = [...new Set(RESTAURANTS.map(r => r.d).filter(Boolean))].sort();
  cuisines.forEach(c => {
    const o = document.createElement('option');
    o.value = c; o.textContent = c;
    cuisineSelect.appendChild(o);
  });
  districts.forEach(d => {
    const o = document.createElement('option');
    o.value = d; o.textContent = d;
    districtSelect.appendChild(o);
  });

  let currentSort = 'rating';

  function sortRestaurants(list, key) {
    return [...list].sort((a, b) => {
      if (key === 'rating') {
        const ra = parseFloat(a.r) || 0;
        const rb = parseFloat(b.r) || 0;
        return rb - ra;
      }
      if (key === 'name') return a.n.localeCompare(b.n, 'es');
      if (key === 'price') {
        const pa = parseInt(a.p) || 9999;
        const pb = parseInt(b.p) || 9999;
        return pa - pb;
      }
      return 0;
    });
  }

  function render() {
    const query = searchInput.value.toLowerCase().trim();
    const cuisine = cuisineSelect.value;
    const district = districtSelect.value;
    const priceRange = priceSelect.value;

    let filtered = RESTAURANTS.filter(r => {
      if (query) {
        const haystack = (r.n + ' ' + r.c + ' ' + r.d + ' ' + r.a).toLowerCase();
        if (!haystack.includes(query)) return false;
      }
      if (cuisine && r.c !== cuisine) return false;
      if (district && r.d !== district) return false;
      if (priceRange) {
        const [min, max] = priceRange.split('-').map(Number);
        const p = parseInt(r.p) || 0;
        if (!r.p || p < min || p > max) return false;
      }
      return true;
    });

    filtered = sortRestaurants(filtered, currentSort);
    statsEl.textContent = filtered.length + ' de ' + RESTAURANTS.length + ' restaurantes';

    if (!filtered.length) {
      grid.innerHTML = '<div class="no-results">No se encontraron restaurantes con esos filtros.</div>';
      return;
    }

    grid.innerHTML = filtered.map(r => {
      const ratingClass = r.r && r.r !== '-' ? '' : ' no-rating';
      const ratingText = r.r && r.r !== '-' ? r.r : '\u2014';
      const cuisineTags = r.c ? r.c.split('\u2022').map(t =>
        '<span class="tag">' + t.trim() + '</span>'
      ).join('') : '';
      const ratingsDetail = [
        r.rf ? 'Comida <strong>' + r.rf + '</strong>' : '',
        r.rd ? 'Decor <strong>' + r.rd + '</strong>' : '',
        r.rs ? 'Servicio <strong>' + r.rs + '</strong>' : '',
      ].filter(Boolean).join(' &middot; ');
      const price = r.p ? r.p + ' &euro;' : '';
      const phone = r.ph ? r.ph : '';
      const gmapsUrl = 'https://www.google.com/maps/search/?api=1&query=' +
        encodeURIComponent(r.n + ', ' + r.a);

      return '<div class="card">' +
        '<div class="card-top">' +
          '<div class="card-name"><a href="' + r.u + '" target="_blank" rel="noopener">' + r.n + '</a></div>' +
          '<div class="card-rating' + ratingClass + '">' + ratingText + '</div>' +
        '</div>' +
        '<div class="card-meta">' +
          (r.d ? '<span>' + r.d + '</span>' : '') +
          (price ? '<span>' + price + '</span>' : '') +
          (phone ? '<span>' + phone + '</span>' : '') +
        '</div>' +
        (cuisineTags ? '<div class="card-tags">' + cuisineTags + '</div>' : '') +
        (ratingsDetail ? '<div class="card-ratings">' + ratingsDetail + '</div>' : '') +
        '<div class="card-actions">' +
          '<a href="' + gmapsUrl + '" target="_blank" rel="noopener">Google Maps</a>' +
          (r.w ? '<a href="' + r.w + '" target="_blank" rel="noopener">Web</a>' : '') +
          '<a href="' + r.u + '" target="_blank" rel="noopener">Macarfi</a>' +
        '</div>' +
      '</div>';
    }).join('');
  }

  // Event listeners
  searchInput.addEventListener('input', render);
  cuisineSelect.addEventListener('change', render);
  districtSelect.addEventListener('change', render);
  priceSelect.addEventListener('change', render);

  document.querySelectorAll('.sort-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentSort = btn.dataset.sort;
      render();
    });
  });

  render();
})();
</script>
</body>
</html>
